{"version":3,"file":"main.js","sources":["../src/main.ts"],"sourcesContent":["import type { Listings } from \"../../types/Listings\";\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  const BASE_URL = \"http://localhost:3000\";\n  const listingLoader = document.querySelector<HTMLDivElement>(\n    `[dev-target=listing-loader]`\n  );\n  const listingList = document.querySelector<HTMLDivElement>(\n    `[dev-target=listing-list]`\n  );\n  const listingItemTemplate = document.querySelector<HTMLDivElement>(\n    `[dev-target=listing-item-template]`\n  );\n  const listingForm = document.querySelector<HTMLFormElement>(\n    `[dev-target=listing-form]`\n  );\n  const emptyState = document.querySelector<HTMLDivElement>(\n    `[dev-target=empty-state]`\n  );\n\n  let currentUnitType = \"\";\n  let minListing = 0;\n  let maxListing = Infinity;\n  let listingSearch = \"\";\n  let globalListings: Listings | null = null;\n\n  if (\n    !listingItemTemplate ||\n    !listingList ||\n    !listingLoader ||\n    !listingForm ||\n    !emptyState\n  ) {\n    return console.error(\"Missing required elements\");\n  }\n\n  try {\n    const listings = await getAllProperties();\n    globalListings = listings;\n    console.log({ listings });\n    listingsInit({\n      listings,\n      emptyState,\n      listingItemTemplate,\n      listingList,\n      listingLoader,\n    });\n    filterInit({\n      listingForm,\n      listingItemTemplate,\n      listingList,\n      listingLoader,\n      emptyState,\n    });\n  } catch (error) {}\n\n  function listingsInit({\n    listings,\n    listingList,\n    listingLoader,\n    listingItemTemplate,\n    emptyState,\n  }: {\n    listings: Listings;\n    listingList: HTMLDivElement;\n    listingLoader: HTMLDivElement;\n    listingItemTemplate: HTMLDivElement;\n    emptyState: HTMLDivElement;\n  }) {\n    listingList.innerHTML = \"\";\n    listings.items.forEach((listing) => {\n      const listingItem = listingItemTemplate.cloneNode(\n        true\n      ) as HTMLAnchorElement;\n      const listingTitle =\n        listingItem.querySelector<HTMLDivElement>(`[dev-target=title]`);\n      const listingPrice =\n        listingItem.querySelector<HTMLDivElement>(`[dev-target=price]`);\n      const listingType = listingItem.querySelector<HTMLDivElement>(\n        `[dev-target=listing-type]`\n      );\n      const listingImage =\n        listingItem.querySelector<HTMLImageElement>(`[dev-target=image]`);\n\n      if (!listingTitle || !listingImage || !listingPrice || !listingType) {\n        return console.error(\"Missing listing item elements\");\n      }\n      listingItem.href = `/property?id=${listing.id}`;\n      listingImage.src = listing.photos[0].original;\n      listingTitle.textContent = `${listing.bedrooms} BED, ${listing.bathrooms} BATH`;\n      listingPrice.textContent = Number(listing.price).toLocaleString();\n      listingType.textContent = listing.property_type;\n\n      listingList.appendChild(listingItem);\n    });\n    if (listings.items.length === 0) {\n      toggleHideElement({ element: emptyState, toggle: \"show\" });\n    } else {\n      toggleHideElement({ element: emptyState, toggle: \"hide\" });\n    }\n    toggleHideElement({ element: listingLoader, toggle: \"hide\" });\n    toggleHideElement({ element: listingList, toggle: \"show\" });\n  }\n\n  function toggleHideElement({\n    element,\n    toggle,\n  }: {\n    element: HTMLElement;\n    toggle: \"show\" | \"hide\";\n  }) {\n    if (toggle === \"show\") {\n      element.setAttribute(\"dev-hide\", \"false\");\n    } else {\n      element.setAttribute(\"dev-hide\", \"true\");\n    }\n  }\n\n  async function getAllProperties() {\n    try {\n      const response = await fetch(`${BASE_URL}/api/listings`);\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch listings\");\n      }\n      const listings: Listings = await response.json();\n      return listings;\n    } catch (error) {\n      console.error(\"Error fetching listings:\", error);\n      throw error;\n    }\n  }\n\n  function filterInit({\n    listingForm,\n    listingItemTemplate,\n    listingList,\n    listingLoader,\n    emptyState,\n  }: {\n    listingForm: HTMLFormElement;\n    listingList: HTMLDivElement;\n    listingLoader: HTMLDivElement;\n    listingItemTemplate: HTMLDivElement;\n    emptyState: HTMLDivElement;\n  }) {\n    const searchInput = listingForm.querySelector<HTMLInputElement>(\n      `[dev-target=listing-search]`\n    );\n    const unitTypeSelect = listingForm.querySelector<HTMLSelectElement>(\n      `[dev-target=listing-unit]`\n    );\n    const minPriceSelect = listingForm.querySelector<HTMLSelectElement>(\n      `[dev-target=listing-min-price]`\n    );\n    const maxPriceSelect = listingForm.querySelector<HTMLSelectElement>(\n      `[dev-target=listing-max-price]`\n    );\n\n    searchInput?.addEventListener(\"input\", (e) => {\n      listingSearch = (e.target as HTMLInputElement).value;\n      console.log({ listingSearch });\n      if (globalListings) {\n        const filteredListing = filterListings({\n          listings: globalListings,\n          maxPrice: maxListing,\n          minPrice: minListing,\n          search: listingSearch,\n          unitType: currentUnitType,\n        });\n        listingsInit({\n          listings: filteredListing,\n          listingItemTemplate,\n          listingList,\n          listingLoader,\n          emptyState,\n        });\n      }\n    });\n\n    maxPriceSelect?.addEventListener(\"change\", (e) => {\n      const value = (e.target as HTMLSelectElement).value;\n      maxListing = value === \"\" ? Infinity : Number(value);\n      console.log({ maxListing });\n      if (globalListings) {\n        const filteredListing = filterListings({\n          listings: globalListings,\n          maxPrice: maxListing,\n          minPrice: minListing,\n          search: listingSearch,\n          unitType: currentUnitType,\n        });\n        listingsInit({\n          listings: filteredListing,\n          listingItemTemplate,\n          listingList,\n          listingLoader,\n          emptyState,\n        });\n      }\n    });\n    minPriceSelect?.addEventListener(\"change\", (e) => {\n      minListing = Number((e.target as HTMLSelectElement).value);\n      console.log({ minListing });\n      if (globalListings) {\n        const filteredListing = filterListings({\n          listings: globalListings,\n          maxPrice: maxListing,\n          minPrice: minListing,\n          search: listingSearch,\n          unitType: currentUnitType,\n        });\n        listingsInit({\n          listings: filteredListing,\n          listingItemTemplate,\n          listingList,\n          listingLoader,\n          emptyState,\n        });\n      }\n    });\n    unitTypeSelect?.addEventListener(\"change\", (e) => {\n      currentUnitType = (e.target as HTMLSelectElement).value;\n      console.log({ currentUnitType });\n      if (globalListings) {\n        const filteredListing = filterListings({\n          listings: globalListings,\n          maxPrice: maxListing,\n          minPrice: minListing,\n          search: listingSearch,\n          unitType: currentUnitType,\n        });\n        listingsInit({\n          listings: filteredListing,\n          listingItemTemplate,\n          listingList,\n          listingLoader,\n          emptyState,\n        });\n      }\n    });\n  }\n\n  function filterListings({\n    listings,\n    search,\n    unitType,\n    minPrice,\n    maxPrice,\n  }: {\n    listings: Listings;\n    search: string;\n    unitType: string;\n    minPrice: number;\n    maxPrice: number;\n  }): Listings {\n    return {\n      ...listings,\n      items: listings.items.filter((listing) => {\n        const matchesSearch =\n          search === \"\" ||\n          listing.property_type.toLowerCase().includes(search.toLowerCase());\n\n        const matchesUnitPrice =\n          unitType === \"\" ||\n          unitType.toLowerCase().trim() ===\n            listing.property_type.toLowerCase().trim();\n\n        const matchesMinPrice = Number(listing.price) >= minPrice;\n\n        const matchesMaxPrice = Number(listing.price) <= maxPrice;\n\n        return (\n          matchesSearch &&\n          matchesMinPrice &&\n          matchesMaxPrice &&\n          matchesUnitPrice\n        );\n      }),\n    };\n  }\n});\n"],"names":["BASE_URL","listingLoader","listingList","listingItemTemplate","listingForm","emptyState","currentUnitType","minListing","maxListing","listingSearch","globalListings","listings","getAllProperties","listingsInit","filterInit","listing","listingItem","listingTitle","listingPrice","listingType","listingImage","toggleHideElement","element","toggle","response","error","searchInput","unitTypeSelect","minPriceSelect","maxPriceSelect","e","filteredListing","filterListings","value","search","unitType","minPrice","maxPrice","matchesSearch","matchesUnitPrice","matchesMinPrice","matchesMaxPrice"],"mappings":"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"}